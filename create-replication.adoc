---
sidebar: sidebar
permalink: create-replication.html
keywords: replication, replicate, data protection, disaster recovery, data loss
summary: "Create a replication relationship for an FSx for ONTAP file system to avoid data loss in case of an unforeseen disaster."
---
= Replicate data to FSx for ONTAP in NetApp Workload Factory
:icons: font
:imagesdir: ./media/

[.lead]
Create a replication relationship for an FSx for ONTAP file system in NetApp Workload Factory to avoid data loss in case of an unforeseen disaster. You can replicate data between two FSx for ONTAP file systems, or between anon-premises ONTAP system and an FSx for ONTAP file system.

For storage VM migration, you must complete the cut over operation right after you create a replication relationship. 

== About this task

Replication protects your data if a disaster affects your region; it can also be used for migration purposes. 

Replicated volumes in the target file system are data protection (DP) volumes and follow the naming format: `{OriginalVolumeName}_copy`.

If you replicate a source volume with immutable files, the target volume and file system remain locked until the source volume's retention period ends. The immutable files feature is available when you link:create-volume.html[create a volume] for an FSx for ONTAP file system. 

[NOTE]
===============================
* Replication isn't supported for block volumes using iSCSI or NVMe protocols.
* You can replicate one source (read/write) volume or one data protection (DP) volume. Cascading replication is supported, but a third hop isn't. Learn more about link:https://review.docs.netapp.com/us-en/workload-fsx-ontap_cascade-replication/cascade-replication.html[cascading replication^].
===============================

=== Migration use cases

When you select the migration use case, you can optionally select to replicate storage VM data and configuration settings for a single storage VM. When migrating data and configuration settings simultaneously, ensure that the last replication for the volume completed in the last 24 hours. All volumes in the same storage VM must be selected to use this feature. The tiering policy for all volumes defaults to the tiering policy of the source volume, which is recommended for migration use cases.

Workload Factory supports migration replication between the following storage systems. 

* On-premises ONTAP systems and FSx for ONTAP file systems 
* Cloud Volumes ONTAP and FSx for ONTAP file systems
* FSx for ONTAP and FSx for ONTAP file systems
** First to first generation 
** First to second generation 
** Second to second generation

To migrate storage VM data and configuration settings, you must complete two operations.

1. <<Create a replication relationship,Create a replication relationship>>, select *Migration* as the use case and select *Replicate storage VM configuration*. 
2. <<Cut over replication for migration use cases,Cut over replication for migration use cases>> to permanently migrate data and configuration settings from the source file system to the target FSx for ONTAP file system.

== Create a replication relationship
Replicate data between two FSx for ONTAP file systems, or between an on-premises ONTAP system and an FSx for ONTAP file system.

.Before you begin
Review these requirements before you begin.

* You must have one FSx for ONTAP file system to use for the target in the replication relationship.
* The FSx for ONTAP file system you use for the replication relationship must have an associated link. link:https://docs.netapp.com/us-en/workload-fsx-ontap/create-link.html[Learn how to associate an existing link or to create and associate a new link]. After you associate the link, return to this operation.
* For replication from an on-premises ONTAP system to an FSx for ONTAP file system, make sure you have discovered the on-premises ONTAP system. 
* Replication isn't supported for volumes in a state other than available, created, or misconfigured, and when the ONTAP version isn't compatible.
* For migration use cases ensure that the last replication for the volume completed in the last 24 hours before you create a replication relationship with storage VM data and configuration settings.

.Steps
. Log in using one of the link:https://docs.netapp.com/us-en/workload-setup-admin/console-experiences.html[console experiences^].
. Select the menu image:workloads-menu-icon.png[The hamburger menu icon is used to navigate to workloads like storage, eda, ai, databases, vmware, and administration.] and then select *Storage*.
. From the Storage menu, select *FSx for ONTAP*. 
. From *FSx for ONTAP*, select the file system that contains the volume(s) to replicate.
. Either replicate all volumes in a file system or replicate select volumes. 
* To replicate all volumes in a file system: From the file system overview, select *Replicate data*.
* To replicate select volumes: From the file system overview, select the *Volumes* tab.
+
In the Volumes table, select one or more volumes and then select *Replicate data*. 
. On the Replicate data page, under Replication target, provide the following: 
include::_include/create-replication.adoc[]
//Referenced in repo: storage-management-fsx-ontap in file: use/task-replicate-data.adoc

[start=8]
//Rachel L: Added a hack to make the last step have a numbered step in the right order.
. Select *Create*. 

.Result
The replication relationship appears in the *Replication relationships* tab in the target FSx for ONTAP file system. 

If you created a replication relationship for migration purposes, you must cut over all the volumes and their associated storage VM to complete migration of storage VM data and configuration settings to the target FSx for ONTAP file system.

== Cut over replication for migration use cases

After creating a replication relationship for a migration use case, you must cut over replication to complete migration of storage VM data and configuration settings to a target FSx for ONTAP file system. Cutover replication permanently migrates data and storage VM configuration settings from the source file system to the target FSx for ONTAP file system. During the cutover, data gets replicated for the last time. The system deletes the source volume(s) after cutover completes. You can't undo this action. 

.Before you begin
Review these requirements before you begin.

* Stop any client access to your storage VM before you cut over replication.
* Ensure all source volumes are not serving any data before you cut over replication.
* Ensure the data is synced between the source and target volumes before you cut over replication. 
* The FSx for ONTAP file system you use for the replication relationship must have an associated link. link:https://docs.netapp.com/us-en/workload-fsx-ontap/create-link.html[Learn how to associate an existing link or to create and associate a new link]. After you associate the link, return to this operation.

.Steps
. Log in using one of the link:https://docs.netapp.com/us-en/workload-setup-admin/console-experiences.html[console experiences^].
. Select the menu image:workloads-menu-icon.png[The hamburger menu icon is used to navigate to workloads like storage, eda, ai, databases, vmware, and administration.] and then select *Storage*.
include::_include/cutover-replication.adoc[]
//Referenced in repo: storage-management-fsx-ontap in file: use/task-replicate-data.adoc

[start=8]
//Rachel L: Added a hack to make the last step have a numbered step in the right order.
. Select *Cut over*.

.Result
After cutover, the source volumes are deleted and the target volumes become read/write. You can link:change-tiering-policy.html[modify the tiering policy] for the target volume(s) after cutover.